# 华东师范大学图书馆座位自动预约脚本

# 配置参数

- 初次使用，需要以下参数
  1. （必须）学号、密码及座位ID。座位ID请查`area`文件夹下的json文件。查询方法如下：
  
     ```json
     {
         "id": 3327,
         "no": "001",
         "name": "001",
         "area": 8,
         "category": 12,
         "point_x": 21.04167,
         "point_x2": null,
         "point_x3": null,
         "point_x4": null,
         "point_y": 75,
         "point_y2": null,
         "point_y3": null,
         "point_y4": null,
         "width": 2.03125,
         "height": 3.173077,
         "status": 1,
         "status_name": "空闲",
         "area_name": "一楼A区",
         "area_levels": 1,
         "area_type": 1,
         "area_color": null
     }
     ```
  
     这是一个座位的详细信息。其中`id`就是座位id，`no`就是实际的座位号，`area_name`就是区域名称。所以上面这个座位是：一楼A区01号座位。其他座位类似，查询到自己想预约的座位的ID即可。目前仅罗列出了中北校区的座位信息。如有需要，可以提issue，我把闵行校区的补上。
  
  2. （非必须）微信账号openid，固定不变，抓一次包记录下来就可以了。如果当前账号没有绑定，则需要此参数，配合`addUser`函数使用。如果已经绑定过了，以后只需要登录就行了。
  
  3. （可选）qq邮箱开通SMTP服务（免费），得到一个授权码，用于向自己发送通知邮件。

# 使用

1. 在脚本中填入学号、密码、座位ID等参数。如果不需要发送邮件，把`SendEmailUtil.sendEmail(EMAIL, content)`语句全部注释即可
2. 确定当前账号是否在公众号上面绑定了。建议先绑定，然后预约只需要依次执行`login()`、`getViableTime()`以及`grabSeat()`三个函数即可。
3. 部署到服务器，使用`crontab`，添加定时任务。定时任务指定执行文件`AutoSeatGrabbing.java`，该文件已经写了主函数，会主动执行预约函数（先把参数填好）
4. 如果起得比较早，可以将定时任务设置在早上7点，脚本会自动开始预约座位
5. 脚本默认预约明天的座位，可以修改`autoGrabSeat`函数，不让日期增加一天
6. 关于`autoGrabSeat`函数，可以适当修改。绑定后不需要重复绑定，每次执行login就行，不需要removeUser和addUser。当然前提是已经绑定过了。

# 适用场景

- 适用于每天早上抢座的同学，将定时任务设置在早上7点，脚本会根据配置好的座位，自动开始预约明天的座位
- 其他时间段抢座需要设置间隔请求，目前还没有做这个功能，不过也简单

# 拓展

核心功能已经实现，推荐做后续开发：

2. 开发临时签离功能，每天中午11点和下午5点定时签离，避免忘记签离导致的座位被释放（今天就忘了，回去的时候座位已经被预约了，但是还没有人去我那位置，不知道是在观望还是干嘛，我只好溜了）
2. 根据预约历史，对数据进行可视化展示，还可以做一个图书馆预约年终总结什么的东西。不过我猜这个信息只会保留几天之内的。因为这个函数的请求参数就必须的两个，没有请求页数、日期范围等参数，所以猜测只能获取到最近几次的预约历史

# 提示

- 仅限华东师范大学学生交流学习，使用时请遵守学校各项管理规定、规范制度

# 其他

- 在抓包的过程中，我也发现了一些有意思的东西：
  1. 可以仅用学号查询对应同学的在馆状态（是否入馆，是否临时离开等）
  2. 可以通过补参数的形式，获取到所有预约历史